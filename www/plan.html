<!doctype html>
<html>
<head>
	<title>OTP test</title>

	<meta charset="utf-8"/>
	<script src="js/lib/jquery-1.8.3.min.js"></script>
	<script src="cordova.js"></script>
	<script src="js/system.js"></script>
	<script src="js/geocode.js"></script>
	<script src="js/otp.js"></script>
	<script src="js/ui.js"></script>
	
	<link href="css/ui-lightness/jquery-ui-1.10.3.custom.css" rel="stylesheet">
	<script src="js/lib/jquery-ui-1.10.3.custom.min.js"></script>
	<style type="text/css">
		section {
			width: 100%;
		}
		
		input {
			width: 75%;
			float: right;
		}
		button, select {
			float: right;
		}
		#plan {
			margin-top: 3em;
		}
		.time {
			float:right;
		}
	</style>
</head>
<body>
	<div id="header">	<span id="left">| <span id="back">&#9668;</span> | <span id="fav">&hearts;</span> |</span>  
						<span id="center">Frits</span> 
						<span id="right">| O | <span id="vraagteken">?</span> |</span></div>
	<section>
		<form class="headerbuffer">
			<div class="licht">
				<label>Van: <input type="text" id="from"></label>
				<input type="hidden" name="fromPlace"><p>
				<div id="fromName" class="donker">...</div>
			</div>
			<div class="donker">
				<label>Naar: <input type="text" id="to"></label>
				<input type="hidden" name="toPlace"><p>
				<div id="toName" class="licht">...</div>
			</div>
			<div class="licht">
				<label>Plan: <select name="arriveBy">
					<option value="false">vertrek</option>
					<option value="true">aankomst</option>
				</select></label>
			</div>
			<div class="donker">
				<label>Date: <input type="date" name="date"></label>
			</div>
			<div class="licht">
				<label>Time: <input type="time" name="time"></label>
			</div>
			<div class="donker">
				<label>Voorkeur: <select name="preferLeastTransfers">
					<option value="false">snelste route</option>
					<option value="true">minst aantal overstappen</option>
				</select></label>
			</div>
			<div class="licht">
				<label>Rolstoel: <input type="checkbox" name="wheelchair" value="true"></label>
			</div>
			<input type="submit" value="Plan">
		</form>
	</section>
	
	<section id="plan">
	</section>
	
	<script src="js/init.js"></script>
	<script>
		
		$(function()
		{
			$("input[name='date']").val(System.getDate());
			$("input[name='time']").val(System.getTime());
			System.getLocation().done(function(coords)
			{
				Geo.decode(coords).done(function(coords, name)
				{
					from.val(name);
					$("input[name='fromPlace']").val(coords);
					$('#fromName').text(name);
				});
			});
			
			var from = $('#from');
			from.keypress(function(event)
			{
				setTimeout(function()
				{
					Geo.code(from.val()).done(function(coords, name)
					{
						$("input[name='fromPlace']").val(coords);
						$('#fromName').text(name);
					});
				}, 0);
			});
			
			var to = $('#to');
			to.keypress(function()
			{
				setTimeout(function()
				{
					Geo.code(to.val()).done(function(coords, name)
					{
						$("input[name='toPlace']").val(coords);
						$('#toName').text(name);
					});
				}, 0);
			});
			
			
			var form = $('form');
			var plan = $('#plan');
			form.submit(function()
			{
				var req = {};
				$.each(form.serializeArray(), function(i, obj)
				{
					req[obj.name] = obj.value;
				});
				
				plan.empty().append($('<h1>').text('Loading...'));
				
				OTP.plan(req).done(function(data)
				{
					console.log(data);
					var route;
					plan.empty().append(route = $('<div>').attr('id', 'route'));
					route.add = UI.addItinerary;
					route.add(data.itineraries[0]);
					route.accordion({collapsible:true});
				}).fail(function(error, message)
				{
					plan.empty()
						.append($('<h1>').text('Oeps!'))
						.append($('<h2>').text(message));
				});
				
				return false;
			});
		});
	</script>
</body>
</html>