<!DOCTYPE HTML> 
<html>
<head>
	<title>Current trip</title>
	<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0'/> 
	<link href='css/swipestyle.css' rel='stylesheet'/>

	<meta charset="utf-8"/>
	<script src="js/lib/prototype-1.7.1.js"></script>
	<script src="js/lib/jquery-1.8.3.min.js"></script>
	<script src="cordova.js"></script>
	<script src="js/misc.js"></script>
	<script src="js/system.js"></script>
	<script src="js/class/localdb.class.js"></script>
	<script src="js/storage.js"></script>
	<script src="js/geocode.js"></script>
	<script src="js/otp.js"></script>
	<script src="js/ui.js"></script>

	<script src="js/lib/jquery-1.9.1.js"></script>
	<script src='js/swipe.js'></script>
	
	<link href="css/ui-lightness/jquery-ui-1.10.3.custom.css" rel="stylesheet">
	<script src="js/lib/jquery-ui-1.10.3.custom.min.js"></script>
	
    <script src="js/lib/jquery.json-2.4.min.js"></script>
    <style type="text/css">
		
		.swipe {
	       overflow: hidden;
		  visibility: hidden;
		  position: relative;
		}
		.swipe-wrap {
		  overflow: hidden;
		  position: relative;
		}
		.swipe-wrap > div {
		  float:left;
		  width:100%;
		  position: relative;
		}
		
		section {
			width: 100%;
		}
		
		input {
			width: 75%;
			float: right;
		}
		select {
			float: right;
		}
		.time {
			float:right;
		}
		
		#sugto, #sugfrom {
			display: none;
		}
		.button {
			border: 1px #358219 solid;
			text-decoration: none;
			border-radius: 15px;
			text-align: center;
		}
		.divbutton {
			text-decoration: none;
		}
		.leg-display{
			background-color: #FFFFFF;
			text-align:center;
		}
		#prevLegButton{
		    margin-right: 20px;
		    width: 100px;
		}
		#nextLegButton{
            width: 100px;
		}
	</style>

</head>
<body>
	<div id="header">
		<span id="left"><span id="back">&lt;</span></span>
		<span id="center">Frits</span> 
		<span id="right"><span id="vraagteken">?</span></span>
	</div>
	
	<section>
		<div class="headerbuffer">
			<div class="eilandLight" class="shadow">
				
				<h1>Current trip</h1>
            
				<div id='mySwipe' style='max-width:500px;margin:0 auto' class='swipe'>
			    	<div class='swipe-wrap'>
				  	</div>
				</div>
                
                <div id="indexindicator" style='float:center;text-align:center;padding-top:20px;'></div>
                
                <div style='text-align:center;padding-top:10px;'>
                    <button class="button" id="prevLegButton" onclick='mySwipe.prev()'>prev</button> 
                    <button class="button" id="nextLegButton" onclick='mySwipe.next()'>next</button>
                </div>
                
				<div class="divborder">
					<label>Iets met het volgende alarm</label><br>
					<label>Iets om het alarm aan/uit te zetten</label>
				</div>
				
				<a href="index.html" class="divbutton"><p class="button">Terug naar hoofdmenu</p></a>
				<a href="index.html" class="divbutton"><p class="button">Annuleer deze reis</p></a>
			
			</div><!-- einde eiland -->
		</div>
	</section>

	<script>
	var triplength = 1;
	
	
	// with jQuery
	// window.mySwipe = $('#mySwipe').Swipe().data('Swipe');
	var modeName = function(mode) {
        modes = {   'WALK': 'Lopen',
                    'BUS': 'Bus',
                    'RAIL': '',
                    'FERRY': 'Veerpond',
                    'TRAM': 'Tram',
                    'SUBWAY': 'Metro'};
        if(!$.inArray(mode, modes)) {
            return mode.toLowerCase();
        } else {
            return modes[mode];
        }
    };
    
    function updateindexindicator(index){
        var ii = $('#indexindicator');
        ii.empty();
        var toAdd = "";
        for(var i = 0; i < triplength; i++){
            if(i == index){
                toAdd = toAdd.concat("&diams; ");
            } else {
                toAdd = toAdd.concat("&bull; ");
    		}
        }
	    ii.append(toAdd);
	}
	
	function initSwipe(){
        var elem = document.getElementById('mySwipe');
        window.mySwipe = Swipe(elem, {
            //startSlide: 4,                              //(default:0) - index position Swipe should start at
            //speed: 300,                                 //(default:300) - speed of prev and next transitions in milliseconds
            //auto: 3000,                                 //begin with auto slideshow (time in milliseconds between slides)
            continuous: false,                            //(default:true) - create an infinite feel with no endpoints
            //disableScroll: true,                        //(default:false) - stop any touches on this container from scrolling the page
            //stopPropagation: true,                      //(default:false) - stop event propagation
            callback: function(index, element) {
                updateindexindicator(index);
            },      //runs at slide change
           //transitionEnd: function(index, element) {}  //runs at the end slide transition
        });
        updateindexindicator(0);
	}
	
	function getLegMode(legs, i) {
        if( i < 0 || i >= legs.length) {
            return '';
        } else {
            return legs[i].mode;
        }
    }
    
	$(function(){
		Storage.Trips.init();
		Storage.Trips.next().done(function(curTrip)
		{
			var sw = $('.swipe-wrap');
			if (curTrip){
                OTP.plan(curTrip).done(function(data)
                {
                    localStorage['OTP data'] = $.toJSON(data);
                    
                    // TODO: use a variation of ui.addItinerary instead?
                    triplength = data.itineraries[0].legs.length;
                    for(var i = 0; i < triplength; i++){
                        var curleg = data.itineraries[0].legs[i];
                        
                        var fromName = curleg.from.name;
                        var toName = curleg.to.name;
                        
                        if(curleg.mode == 'RAIL') {
                            fromName = 'Station ' + fromName + ' - Perron ' + curleg.from.platformCode;
                            toName = 'Station ' + toName + '  - Perron ' + curleg.to.platformCode;
                        } else {
                            if(getLegMode(data.itineraries[0].legs, i-1) == 'RAIL') {
                                fromName = 'Station ' + fromName;
                            }
                            if(getLegMode(data.itineraries[0].legs, i+1) == 'RAIL') {
                                toName = 'Station ' + toName;
                            }
                        }
                        
                        sw.append($('<div>')
                            .addClass("leg-display")
                            .append($('<label>').text(modeName(curleg.mode) + ' ' + curleg.route))
                            .append($('<br>'))
                            .append($('<br>'))
                            .append($('<label style="float:left">').text(fromName))
                            .append($('<label style="float:right">').text(UI.formatTime(curleg.startTime)))
                            .append($('<br>'))
                            .append("&darr;")
                            .append($('<br>'))
                            .append($('<label style="float:left">').text(toName))
                            .append($('<label style="float:right">').text(UI.formatTime(curleg.endTime)))
                            .append($('<br>'))
                            .append($('<br>'))
                            .append($('<div class="button" id="legmap' + i + '">')
                                .append("<p>Open map</p>"))
                        );
                        $('#legmap' + i + '').click(function()
                        {
                            clickMap(this.id.substring(6));
                        });
                    }
                    initSwipe();
                }).fail(function(error, message)
                {
                    // TODO: add something here to notificate the user of the failure
                    console.log("Fail!");
                });
			} else {
				sw.append($('<div class="leg-display">').html("Gefeliciteerd met het vinden van de credits!"));
				sw.append($('<div class="leg-display">').html("Credits:"));
				sw.append($('<div class="leg-display">').html("Opdrachtgever: <br> Paul Jansen"));
				sw.append($('<div class="leg-display">').html("Research: <br> Henk Alkema <br> Ferry Timmers <br> Jeroen van de Ven"));
				sw.append($('<div class="leg-display">').html("Documentatie: <br> Henk Alkema <br> Ferry Timmers <br> Jeroen van de Ven <br> Philip Klees <br> Florian Oosterhof <br> Sjarlie Graaumans <br> Frederique Gerritsen <br> Max Hageluken"));
				sw.append($('<div class="leg-display">').html("Design: <br> Henk Alkema <br> Frederique Gerritsen"));
                sw.append($('<div class="leg-display">').html("Database: <br> Ferry Timmers <br> Jeroen van de Ven"));
                sw.append($('<div class="leg-display">').html("CSS: <br> Henk Alkema <br> Frederique Gerritsen <br> Jeroen van de Ven"));
				sw.append($('<div class="leg-display">').html("Javascript/JQuery: <br> Henk Alkema <br> Ferry Timmers <br> Jeroen van de Ven <br> Philip Klees <br> Florian Oosterhof <br> Sjarlie Graaumans <br> Frederique Gerritsen <br> Max Hageluken"));
				sw.append($('<div class="leg-display">').html("Groep Cup-A-SEP <br> Technische Universiteit Eindhoven"));
				triplength = 10;
                initSwipe();
			}
		});
	});
	
	
    function clickMap(i)
    {
        localStorage['ShowMap'] = i;
        window.location = "legmap.html";
    }
	</script>
</body>
</html>